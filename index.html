<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Echo Protocols</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="white">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FFFFFF">
    <meta name="apple-mobile-web-app-title" content="Echo">
    <style>
        /* --- 1. CSS STYLES --- */
        :root {
            --background-color: #FFFFFF;
            --text-color: #000000;
            --border-color: #000000;
            --button-bg-color: #f0f0f0;
            --button-active-bg: #dcdcdc;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            overscroll-behavior: none;
        }
        .page {
            display: none;
            width: 100%;
            height: 100%;
            padding: 20px;
            overflow-y: auto;
            flex-direction: column;
        }
        .page.active {
            display: flex;
        }
        .main-menu {
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: center;
            flex-grow: 1;
        }
        .btn {
            padding: 20px;
            font-size: 1.2rem;
            text-align: center;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            background-color: var(--button-bg-color);
            color: var(--text-color);
            width: 100%;
            -webkit-tap-highlight-color: transparent;
        }
        .btn:active {
            background-color: var(--button-active-bg);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-shrink: 0;
        }
        .header h1 {
            font-size: 1.5rem;
            text-align: right;
        }
        .back-btn {
            font-size: 1.1rem;
            padding: 8px 15px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: transparent;
            color: var(--text-color);
            white-space: nowrap;
        }
        .content {
            font-size: 1rem;
            line-height: 1.6;
            white-space: pre-wrap;
            flex-grow: 1;
        }
        .content strong {
            font-weight: bold;
        }
        .content h2 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-size: 1.2rem;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }
        .hidden {
            display: none !important;
        }
        .disclaimer {
            font-size: 0.75rem;
            color: #6c757d;
            text-align: center;
            margin-bottom: 30px;
            padding: 0 20px;
            flex-shrink: 0;
        }
    </style>
</head>
<body>

    <div id="home-page" class="page active">
        <p class="disclaimer">
            These protocols are not endorsed by any professional bodies. Use at your own risk.
        </p>
        <div class="main-menu">
            <div class="btn" data-page="iheartscan-page">iHeartScan</div>
            <div class="btn" data-page="standard-echo-page">Standard Echocardiography Protocol</div>
            <div class="btn" data-page="pocus-page">POCUS</div>
            <div class="btn" data-page="limited-lv-page">Limited LV Assessment</div>
            <div class="btn" data-page="limited-rv-page">Limited RV Assessment</div>
            <div class="btn" data-page="limited-valve-page">Limited Scan Protocol for Mitral and Aortic Valves</div>
            <div class="btn" data-page="pathology-menu-page">By Pathology (Minimal Scan)</div>
        </div>
    </div>

    <div id="pathology-menu-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>By Pathology</h1>
        </div>
        <div class="main-menu">
            <div class="btn" data-page="hypovolaemia-page">Hypovolaemia</div>
            <div class="btn" data-page="cardiogenic-shock-page">Cardiogenic Shock</div>
            <div class="btn" data-page="tamponade-page">Tamponade</div>
            <div class="btn" data-page="pulmonary-hypertension-page">Pulmonary Hypertension</div>
            <div class="btn" data-page="pulmonary-embolus-page">Pulmonary Embolus</div>
            <div class="btn" data-page="mitral-valve-pathology-page">Mitral Valve</div>
            <div class="btn" data-page="aortic-valve-pathology-page">Aortic Valve</div>
        </div>
    </div>
    
    <div id="iheartscan-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>iHeartScan</h1>
        </div>
        <div id="iheartscan-content" class="content"></div>
    </div>
    <div id="standard-echo-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>Standard Echo Protocol</h1>
        </div>
        <div id="standard-echo-content" class="content"></div>
    </div>
    <div id="pocus-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>POCUS</h1>
        </div>
        <div id="pocus-content" class="content"></div>
    </div>
    <div id="limited-lv-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>Limited LV</h1>
        </div>
        <div id="limited-lv-content" class="content"></div>
    </div>
    <div id="limited-rv-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>Limited RV</h1>
        </div>
        <div id="limited-rv-content" class="content"></div>
    </div>
    <div id="limited-valve-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>Mitral & Aortic Valves</h1>
        </div>
        <div id="limited-valve-content" class="content"></div>
    </div>

    <div id="hypovolaemia-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>Hypovolaemia vs Vasodilation</h1>
        </div>
        <div id="hypovolaemia-content" class="content"></div>
    </div>
    <div id="cardiogenic-shock-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>Cardiogenic Shock</h1>
        </div>
        <div id="cardiogenic-shock-content" class="content"></div>
    </div>
    <div id="tamponade-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>Tamponade</h1>
        </div>
        <div id="tamponade-content" class="content"></div>
    </div>
    <div id="pulmonary-hypertension-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>Pulmonary HT</h1>
        </div>
        <div id="pulmonary-hypertension-content" class="content"></div>
    </div>
    <div id="pulmonary-embolus-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>Pulmonary Embolus</h1>
        </div>
        <div id="pulmonary-embolus-content" class="content"></div>
    </div>
    <div id="mitral-valve-pathology-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>Mitral Valve</h1>
        </div>
        <div id="mitral-valve-pathology-content" class="content"></div>
    </div>
    <div id="aortic-valve-pathology-page" class="page">
        <div class="header">
            <button class="back-btn">&lt; Back</button>
            <h1>Aortic Valve</h1>
        </div>
        <div id="aortic-valve-pathology-content" class="content"></div>
    </div>


    <script>
    // JavaScript Logic
    document.addEventListener('DOMContentLoaded', () => {
        const defaultContent = {
            'iheartscan': `iHeartScan Protocol
* Add details here...`,
            'standard-echo': `* Confirm patient ID. Acquire height, weight and blood pressure. [cite: 2]
* Ensure quality ECG trace is available. [cite: 3]

Parasternal Long Axis (PLAX) [cite: 4]
**Left Ventricle** [cite: 5]
* 2D overview at increased depth (screen for posterior pathology: pleural effusion, mass, etc.) [cite: 6]
* 2D overview optimized at appropriate depth [cite: 7]
* 2D measurements: IVSD, LVEDD, PWD [cite: 8]

**Aortic Valve** [cite: 9]
* 2D zoom aortic valve [cite: 10]
* LVOT diameter measurement [cite: 11]
* Color Doppler - aortic valve [cite: 12]
* Aortic root measurements: Trans-sinus, Sinotubular junction, Ascending aorta (higher window as needed) [cite: 13]

**Mitral Valve** [cite: 14]
* 2D Zoom mitral valve [cite: 15]
* Color Doppler - mitral valve [cite: 16]

**RVOT view** [cite: 17]
* 2D overview [cite: 18]
* 2D zoom pulmonary valve [cite: 19]
* Color Doppler [cite: 20]
* PW Doppler in RVOT [cite: 21]
* CW Doppler through valve: Optimised for forward flow ± regurgitation [cite: 22]

**RV inflow view** [cite: 23]
* 2D overview [cite: 24]
* 2D zoom tricuspid valve [cite: 25]
* Color Doppler [cite: 26]
* CW Doppler optimised for TR (TR Vmax) [cite: 27]

Parasternal Short Axis (PSAX) [cite: 28]
**Mid Left Ventricular level** [cite: 29]
* 2D overview [cite: 30]

**Mitral Valve Level** [cite: 31]
* 2D overview [cite: 32]
* 2D zoom MV [cite: 33]
* Color Doppler MV [cite: 34]

**Aortic Valve Level** [cite: 35]
* 2D overview [cite: 36]
* 2D zoom - aortic valve [cite: 37]
* Color Doppler (may need separate clips for PV and pulm artery bifurcation) [cite: 38]
* 2D zoom - pulmonary valve [cite: 39]
* Color Doppler [cite: 40]
* CW Doppler [cite: 41]
* 2D zoom – tricuspid valve [cite: 42]
* Color Doppler [cite: 43]
* CW Doppler optimised for TR (TR Vmax) [cite: 44]

Apical Views [cite: 45]
**Apical 4 Chamber (A4C)** [cite: 46]
* 2D overview [cite: 47]
* Atrial volume measurements [cite: 48]
* 2D zoom mitral valve [cite: 49]
* Color Doppler [cite: 50]
* PW Doppler mitral inflow (E, A, Decel Time) [cite: 51]
* PW Doppler pulmonary venous flow [cite: 52]
* TDI: Septal E’, Lateral E’, RV S’ [cite: 53]
* TAPSE [cite: 54]
* 2D zoom tricuspid valve [cite: 55]
* Color Doppler [cite: 56]
* CW Doppler tricuspid valve (TR Vmax) [cite: 57]
* 2D zoom LV ± MOD LV volume [cite: 58]
* 2D zoom RV [cite: 59]
* RV measurements [cite: 60]

**Apical 5 Chamber (A5C)** [cite: 61]
* 2D overview [cite: 62]
* 2D zoom aortic valve [cite: 63]
* Color Doppler [cite: 64]

**Apical 2 Chamber (A2C)** [cite: 65]
* 2D overview [cite: 66]
* LA volume measurement [cite: 67]
* 2D zoom mitral valve [cite: 68]
* Color Doppler [cite: 69]
* 2D zoom LV ± MOD LV volume [cite: 70]

**Apical Long Axis (APLAX)** [cite: 71]
* 2D overview [cite: 72]
* 2D zoom LV [cite: 73]
* 2D zoom mitral valve [cite: 74]
* Color Doppler – mitral valve [cite: 75]
* 2D zoom aortic valve [cite: 76]
* Color Doppler – aortic valve [cite: 77]
* PW Doppler LVOT (LVOT VTI) [cite: 78]
* CW Doppler aortic valve (AoV VTI) [cite: 79]

**Apical SAX** [cite: 80]
* 2D overview [cite: 81]
* PEDOF from apical window (if needed) [cite: 82]

Subcostal Views [cite: 83]
**Subcostal 4 Chamber** [cite: 84]
* 2D overview [cite: 85]
* 2D zoom IAS [cite: 86]
* Color Doppler IAS [cite: 87]

**Subcostal SAX** [cite: 88]
* 2D overview [cite: 89]
* 2D zoom IAS [cite: 90]
* Color Doppler IAS [cite: 91]

**IVC / Abdominal Aorta** [cite: 92]
* 2D IVC clip to show respiratory variability [cite: 93]
* ± Hepatic venous PW Doppler [cite: 94]
* ± Abdominal aorta PW Doppler [cite: 95]

Suprasternal Notch View [cite: 96]
**SSN - LAX** [cite: 97]
* 2D overview [cite: 98]
* Color Doppler [cite: 99]
* PW Doppler [cite: 100]
* CW Doppler [cite: 101]
* ± PEDOF [cite: 102]

Right Sternal Edge View [cite: 103]
Use when aorta appears dilated in PLAX or if aortic stenosis suspected [cite: 104]
**RSE - Aorta LAX** [cite: 105]
* 2D overview [cite: 106]
* Measurement mid ascending aorta [cite: 107]
* ± PEDOF [cite: 108]`,
            pocus: `PLAX
* 20cm, exclude effusions
* LVEDD
* Colour flow doppler mitral and aortic valves
* LVOT diameter
* Aortic valve opening

PLAX - RV inflow
* TR jet assessment
* RVSP estimation

PSAX
* Assess RWMA
* LVEDD

Apical 4 / 5 chamber view
* LV - Simpsons biplane (if no MR on PLAX), LVOT VTI - pulsed wave with cursor in LVOT
* RV - dimensions and fractional area change, TAPSE with M-mode over lateral edge of tricuspid annulus
* Mitral valve - colour flow doppler, continuous wave doppler over inflow
* Aortic valve - colour flow doppler, continuous wave doppler over inflow
* Tricuspid valve - colour flow doppler, continuous wave doppler to get TR jet velocity

Subcostal 4 chamber
* Effusion assessment
* IVC diameter
* IVC change with sniff

Haemodynamic state assessment
* Hypovolaemia
* LV systolic dysfunction
* RV systolic dysfunction
* Valvular dysfunction
* Pericardial effusion`,
            'limited-lv': `PLAX (pericardial effusion)
* LVEDD
* LVOTd
* Assess mitral valve for regurg - regurg is a contraindication to a biplane EF

PSAX
* Assess for RWMAs - divided into 6 sectors

Apical 5 chamber view
* LVOT VTI

Apical 4 chamber view
* Biplane EF`,
            'limited-rv': `PLAX
* set depth to 20cm, check for pericardial effusion)
* Tricuspid regurg, continuous wave doppler over the TR jet -> freeze > measure peak velocity -> **4V2 = PASP**

PSAX - mid pap
* Check for septal flattening
* During systole suggests pressure overload
* During diastole suggests volume overload

PSAX - aortic
* TR jet peak velocity via cont wave doppler -> 4V2=PASP
* Pulmonary artery acceleration time - continuous wave doppler through the pulmonary valve, measure the time from beginning of ejection to peak ejection
  * >120msec is normal
  * <120msec = elevated PVR
  * < 80msec = highly elevated PVR

Apical 4 chamber view
* Tricuspid valve TR jet peak velocity
* RV chamber quantification at end diastole
  * Basal diameter ( should be <4.2)
  * Mid diameter (should be <3.5)
  * Major axis (should be <8.6)
* RV Fractional area change (>35% normal, <35% abnormal, <18% severely abnormal)
* TAPSE - M-mode through the lateral part of the tricuspid annulus (<17mm suggests dysfunction)`,
            'limited-valve': `PLAX
* check for effusion
* MV 2D qualitative assessment - thickening, diastolic doming, hockey stick
* MV regurgitation - colour flow doppler
  * VC < 3mm = mild MR
  * VC > 7mm = severe MR
  * eccentric jet - at least moderate MR
  * **posterior severe MR + peri-arrest may suggest SAM/LVOTO**
* AV 2D qualitative assessment - calcification, restriction
  * maximal aortic cusp separation (>1.2cm unlikely severe AS)
* AV regurg - colour flow doppler, measure VC or LVOT:jet width ratio
  * VC < 3mm = mild AR
  * VC > 6mm = severe AR
  * LVOT:jet < 25% = mild AR
    * 25-65% mod AR
    * > 65% severe AR

PSAX
* mitral valve planimetry - 2D trace of maximal MV opening area
  * > 1.5cm2 - mild MS/normal
  * 1-1.5cm2 - moderate MS
  * < 1cm2 - severe MS

Apical 4/5 chamber view
* MV 2d - as per PLAX
* MV regurg - as per PLAX
* MV mean pressure gradient - contiuous wave Doppler through mitral valve
  * trace valve inflow envelope (E and A wave)
  * MPG < 5mmHg = mild MS
  * MPG 5-10mmHg = mod MS
  * MPG > 10mmHg = severe MS
* LVOT VTI - pulsed wave Doppler 0.5-1.0cm from AV on ventricular side
* AV mean pressure gradient - continuous wave Doppler through AV
  * trace valve outflow envelope
  * MPG < 20mmHg = mild AS (assuming normal LV function)
  * MPG 20-40 = mod AS
  * MPG > 40mmHg = severe AS`,
            'hypovolaemia': `Parasternal Long-Axis
* LVEDD and FS [cite: 113]
* LVOTd [cite: 114]

Parasternal short Axis [cite: 115]
* FAC [cite: 116]

Apical 5 Chamber [cite: 117]
* LVOT VTI [cite: 118]

**Post-scan expected data - hypovolaemia:** [cite: 119]
* LVEDD low [cite: 120]
* FS / FAC high or normal [cite: 121]
* Cardiac output by doppler VTI low [cite: 122]

**Post-scan expected data – vasodilation** [cite: 123]
* LVEDD normal [cite: 124]
* FS / FAC high [cite: 125]`,
            'cardiogenic-shock': `Parasternal Long-Axis [cite: 127]
* LVOTd [cite: 128]
* LVEDD [cite: 129]
* Mitral valve regurgitation assessment [cite: 130]

Parasternal Short-Axis (mid-papillary) [cite: 131]
* Regional wall motion assessment [cite: 132]

A4C/5C [cite: 133]
* LVOT VTI [cite: 134]
* RV TAPSE [cite: 135]

**Post-scan expected data:** [cite: 136]
* LVEDD normal or high [cite: 137]
* Cardiac output by LVOT VTI low [cite: 138]
* Regional wall motion abnormality [cite: 139]
* Normal or concurrent RV failure (TAPSE) [cite: 140]
* If previously reported “normal EF%” must exclude moderate to severe MR [cite: 141]
  * CO by doppler will supersede this as this is forward flow only [cite: 142]`,
            'tamponade': `Parasternal Long-Axis View [cite: 144]
* Effusion between LV posterior wall and Aorta [cite: 145]

Any view [cite: 146]
* Effusion >2cm [cite: 147]

A4C [cite: 148]
* Tamponade physiology [cite: 149]
* RV collapse in diastole, RA collapse in systole [cite: 150]

Subcostal view [cite: 151]
* Tamponade physiology [cite: 152]
* RV collapse in diastole, RA collapse in systole [cite: 153]
* IVC plethora (>2.1cm) [cite: 154]`,
            'pulmonary-hypertension': `Apical 4-chamber view [cite: 192]
* CWD across tricuspid valve for pulmonary pressures [cite: 193]
* Trace regurgitant jet - V [cite: 194]
* RV TAPSE and visual assessment [cite: 195]

Subcostal IVC [cite: 196]
* Freeze and measure or M-mode [cite: 197]
* Assess collapsibility [cite: 198]
* Estimate RAP [cite: 199]

Post scan expected data [cite: 200]
* **RVSP = 4V² + RAP** [cite: 201]
* **SPAP ~ RVSP** [cite: 202]
* **mPAP ~ 0.6 x SPAP + 2** [cite: 203]
* mPAP > 20mmHg = pulm HTN [cite: 204]
* RVSP > 30mmHg = pulm HTN [cite: 205]`,
            'pulmonary-embolus': `Pulmonary Embolus Protocol
* Add details here...`,
            'mitral-valve-pathology': `Apical 4-Chamber view [cite: 156]
* Mitral valve regurgitation assessment [cite: 157]
* CWD across mitral valve [cite: 158]
* LA volume [cite: 159]
* CWD across tricuspid valve for pulmonary pressures [cite: 160]
* RV TAPSE [cite: 161]

Expected post-scan findings [cite: 162]
**Stenosis** [cite: 163]
* High MPG [cite: 164]
* High LA volume [cite: 165]
* +/- pulmonary hypertension [cite: 166]
* +/- RV dysfunction [cite: 167]

**Regurgitation** [cite: 168]
* Eccentric jet, > 20% LA [cite: 169]
* +/- pulmonary hypertension [cite: 170]
* +/- RV dysfunction [cite: 171]`,
            'aortic-valve-pathology': `Parasternal Long-axis view [cite: 173]
* AV valve leaflet opening >1.2cm [cite: 174]
* LVOTd [cite: 175]
* IVS / posterior wall dimension [cite: 176]

Parasternal SAX view [cite: 177]
* Assess LV function [cite: 178]
* Visual / FAC [cite: 179]
* Posterior wall dimension [cite: 180]

A5C [cite: 181]
* LVOT VTI [cite: 182]
* AVA / LV function [cite: 183]
* AV CWD [cite: 184]

Expected post-scan findings [cite: 185]
* Restricted valve-leaflet opening [cite: 186]
* High valve MPG or Velocity [cite: 187]
* Small AVA [cite: 188]
* LVH [cite: 189]
* Assess in context of LV function [cite: 190]`
        };
        
        const contentElements = {
            'iheartscan': document.getElementById('iheartscan-content'),
            'standard-echo': document.getElementById('standard-echo-content'),
            pocus: document.getElementById('pocus-content'),
            'limited-lv': document.getElementById('limited-lv-content'),
            'limited-rv': document.getElementById('limited-rv-content'),
            'limited-valve': document.getElementById('limited-valve-content'),
            'hypovolaemia': document.getElementById('hypovolaemia-content'),
            'cardiogenic-shock': document.getElementById('cardiogenic-shock-content'),
            'tamponade': document.getElementById('tamponade-content'),
            'pulmonary-hypertension': document.getElementById('pulmonary-hypertension-content'),
            'pulmonary-embolus': document.getElementById('pulmonary-embolus-content'),
            'mitral-valve-pathology': document.getElementById('mitral-valve-pathology-content'),
            'aortic-valve-pathology': document.getElementById('aortic-valve-pathology-content')
        };
        
        let currentPageId = 'home-page';

        const init = () => {
            loadAllContent();
            setupEventListeners();
            registerServiceWorker();
            // Set the initial history state for the home page
            history.replaceState({page: 'home-page', parent: null}, '');
        };

        const parseMarkdown = (text) => {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .split('\n').map(line => {
                    const trimmedLine = line.trim();
                    if (trimmedLine.startsWith('* ')) {
                        const indent = line.search(/\S/);
                        const indentSpaces = '&nbsp;'.repeat(indent);
                        return `${indentSpaces}&bull; ${trimmedLine.substring(2)}`;
                    }
                    if (trimmedLine.length > 0 && !trimmedLine.includes('->') && !trimmedLine.includes('=')) {
                        const isHeading = !/[:*]/.test(line) && line.length < 50;
                        if (isHeading) return `<h2>${trimmedLine}</h2>`;
                    }
                    return line;
                }).join('<br>').replace(/<br>\s*<br>/g, '<br><br>');
        };

        const loadContent = (protocol) => {
            const savedContent = localStorage.getItem(`echo_app_content_${protocol}`);
            const content = savedContent || defaultContent[protocol];
            contentElements[protocol].innerHTML = parseMarkdown(content);
        };
        
        const loadAllContent = () => {
            for (const protocol in defaultContent) {
                if(contentElements[protocol]) loadContent(protocol);
            }
        };

        const renderPage = (pageId) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            currentPageId = pageId;
        };

        const showPage = (pageId) => {
            const parentPageId = currentPageId;
            renderPage(pageId);
            history.pushState({page: pageId, parent: parentPageId}, '');
        };

        // --- BROWSER BACK BUTTON HANDLER ---
        window.onpopstate = function(event) {
            const pageIdToShow = (event.state && event.state.page) ? event.state.page : 'home-page';
            renderPage(pageIdToShow);
        };

        const setupEventListeners = () => {
            document.querySelectorAll('.btn[data-page]').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!btn.classList.contains('disabled')) showPage(btn.dataset.page);
                });
            });
            document.querySelectorAll('.back-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    history.back();
                });
            });
        };
        
        const registerServiceWorker = () => {
            if ('serviceWorker' in navigator) {
                const swContent = `
                    const CACHE_NAME = 'echo-app-cache-v1';
                    const urlsToCache = ['./', 'manifest.json', 'icon-512x512.png'];
                    self.addEventListener('install', e => e.waitUntil(caches.open(CACHE_NAME).then(c => c.addAll(urlsToCache))));
                    self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));
                `;
                const blob = new Blob([swContent], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                navigator.serviceWorker.register(swUrl)
                    .then(reg => console.log('Service Worker registered.'))
                    .catch(err => console.error('Service Worker registration failed:', err));
            }
        };
        
        init();
    });
    </script>
</body>
</html>
